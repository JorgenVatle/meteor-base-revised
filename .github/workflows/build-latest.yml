# Build for latest Meteor release
name: 'Build: latest'
run-name: 'üêã Build: latest | ${{ github.event.head_commit.message || github.event.pull_request.title }}'
on:
  schedule:
    - cron: 0 0 * * *
  push:
    branches:
      - master

jobs:
  info:
    name: 'Query latest Meteor version'
    runs-on: ubuntu-22.04
    outputs:
      packageInfo: ${{ steps.version.packageInfo }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
      - name: Get latest Meteor version
        id: version
        # language="bashsupport pro shell script"
        run: |
          {
            echo 'packageInfo<<EOF'
            echo [
            npm view meteor --json
            echo ]
            echo EOF
          } >> "$GITHUB_OUTPUT"
  build:
    name: Build
    uses: ./.github/workflows/_build.yml
    needs: info
    strategy:
      matrix:
        include: ${{ fromJSON(needs.info.outputs.packageInfo) }}
    with:
      meteor_version: ${{ matrix.dist-tags.latest }}